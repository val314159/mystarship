<script src="/static/uned.js"></script>
<script src="/static/u.js"></script>
<script src="/static/rpc2.js"></script>

<a href="/">Reload</a>
Status: <span id="status">LOADING</span>

<pre id="dired_a">LOADING</pre>

<div id="dired_a.path">LOADING</div>

<hr>
<div id="combo_a.path">LOADING</div>
<hr>

<div id="bufed_a.path">LOADING</div>
<pre id="bufed_a">BUFED_A</pre>

<hr>

<pre id="bufed_b" style="height: 5em">BUFED_B</pre>

<hr>

<script src="http://ace.ajax.org/build/src/ace.js"
	type="text/javascript" charset="utf-8"></script>
<script>
function loadUp(fname) { 
  alert("XX:"+fname);
  RPC.rpcSend("load",[fname],function(x){
    LOG("LOADED!"+str(x.result));
  })
}
var RPC=new WS("/ws",function(x){$E('#status').innerHTML=x});

function loadDir(x){
    var elt=$E('#dired_a');
    elt.innerHTML = ''
    var files = x.result[0];
    for (var n=0; n<files.length; n++) {
//LOG("QQ:"+files[n]+"::"+x.result[2]);
      elt.innerHTML += '<a onclick=loadUp("'+x.result[2]+'/'+files[n]+'") href="#'+files[n]+'">'+files[n]+'</a><br>'
    }
}
function loadFile(x){
    var _0 = x.result[0];
    editor1.setValue(_0)
}

function loadUp(filename){
  RPC.rpcSend("load",[filename],function(x){
    LOG("LOADED2!"+str(x.result));
    if (typeof(x.result[0])=="string") loadFile(x); else loadDir(x);
  })
  LOG("REQ SENT");
}

RPC.reconnect(function(){
  LOG("GOT IN")
  RPC.rpcSend("load",['.'],loadDir);
});
var editor1 = new G.BufEd("bufed_a");
var editor2 = ace.edit("bufed_b");
</script>
